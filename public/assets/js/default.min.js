$(function() {
	$.widget("custom.catcomplete", $.ui.autocomplete, {
		_create: function() {
			this._super();
			this.widget().menu("option", "items", "> :not(.ui-autocomplete-category)")
		},
		_renderMenu: function(n, t) {
			var i = this;
			$.each(t, function(t, r) {
				var u, f = "",
					e;
				if (r.isCity && (f = "City"), r.country == "-sky") {
					f = "Country";
					return
				}
				u = i.__renderItemData(n, r, f);
				r.category && (u.attr("aria-label", r.category + " : " + r.label), e = window.isRTLbool ? "padding-right:30px;" : "padding-left:30px;", u.attr("style", e))
			})
		},
		__renderItemData: function(n, t, i) {
			return this.__renderItem(n, t, i).data("ui-autocomplete-item", t)
		},
		__renderItem: function(n, t, i) {
			return i == "Country" ? $("<li>").append($("<a>").html("<i class='fa fa-globe' aria-hidden='true'><\/i><span>" + t.label + "<\/span>")).appendTo(n) : i == "City" ? $("<li>").append($("<a>").html("<i class='fa fa-map-marker' aria-hidden='true'><\/i><span>" + t.label + "<\/span>")).appendTo(n) : $("<li>").append($("<a>").html("<i class='fa fa-plane' aria-hidden='true'><\/i><span>" + t.label + "<\/span>")).appendTo(n)
		}
	});
	var n = "",
		t = "",
		i = "<%= AutocompleteUrl %>";
	$("#tbFrom").catcomplete({
		delay: 0,
		select: function(n, t) {
			$("#hdnSourceAirport").val(t.item.sourceAirport)
		},
		source: function(r, u) {
			var f = i.replace("{query}", r.term);
			$.ajax({
				url: "/api/flightsearch/GetAutoSuggestAirport",
				data: {
					searchQuery: r.term,
					Currency: $("#Flight-API-FlightCurrency").val() === undefined ? "AED" : $("#Flight-API-FlightCurrency").val(),
					settingsID: $("#Flight-API-FlightSettings").val()
				},
				contentType: "application/json; charset=utf-8",
				dataType: "json",
				success: function(i) {
					i && (n = "", t = "", u($.map(i.places, function(i) {
						if (!i.cityId || i.cityId != "DXBA-sky") return i.placeId == i.cityId ? (n = i.placeName + ", " + i.countryName + " (" + i.placeId + ")", t = i.cityId, {
							label: i.placeName + ", " + i.countryName + " (" + i.placeId.replace("-sky", "") + ")",
							value: i.placeName + ", " + i.countryName + " (" + i.placeId.replace("-sky", "") + ")",
							isCity: !0,
							sourceAirport: i.placeId
						}) : i.cityId == t ? {
							label: i.placeName + ", " + i.countryName + " (" + i.placeId.replace("-sky", "") + ")",
							value: i.placeName + ", " + i.countryName + " (" + i.placeId.replace("-sky", "") + ")",
							category: n,
							sourceAirport: i.placeId
						} : {
							label: i.placeName + ", " + i.countryName + " (" + i.placeId.replace("-sky", "") + ")",
							value: i.placeName + ", " + i.countryName + " (" + i.placeId.replace("-sky", "") + ")",
							country: i.cityId,
							sourceAirport: i.placeId
						}
					})))
				}
			})
		},
		position: window.isRTLbool ? {
			my: "right top",
			at: "right bottom",
			collision: "none"
		} : {}
	})
});